parameter (or :_entries (string %deposit) (or (pair %withdraw string key_hash) (address %change_admin)));
storage (pair :storage (map %deposits string mutez) (address %admin));
code { DUP ;
       DIP { CDR @storage_slash_1 } ;
       CAR @parameter_slash_2 ;
       DUP @parameter ;
       IF_LEFT { RENAME @identity_slash_9 ;
                 { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                 AMOUNT ;
                 PUSH mutez 0 ;
                 { DIP { DUP @xtz } ; SWAP } ;
                 COMPARE ;
                 GT ;
                 IF { DUP @xtz }
                    { SENDER ;
                      PUSH string "xtz amount must be more than 0" ;
                      PAIR ;
                      FAILWITH } ;
                 DIP { DROP } ;
                 { DIP { DUP @storage } ; SWAP } ;
                 CAR %deposits ;
                 { DIP { { DIP { { DIP { DUP @identity } ; SWAP } } ; SWAP } } ; SWAP } ;
                 GET ;
                 IF_NONE { { DIP { DUP @storage } ; SWAP } ;
                           CDR %admin ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           CAR %deposits ;
                           { DIP { { DIP { DUP @new_deposit } ; SWAP } } ; SWAP } ;
                           { DIP { { DIP { { DIP { { DIP { { DIP { DUP @identity } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           DIP { SOME } ;
                           UPDATE ;
                           PAIR %deposits %admin ;
                           NIL operation ;
                           PAIR }
                         { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           CDR %admin ;
                           { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                           CAR %deposits ;
                           { DIP { { DIP { DUP @deposit } ; SWAP } } ; SWAP } ;
                           { DIP { { DIP { { DIP { { DIP { DUP @new_deposit } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           ADD ;
                           { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @identity } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           DIP { SOME } ;
                           DIP { DIP { DIP { DIP { DROP } } } } ;
                           UPDATE ;
                           PAIR %deposits %admin ;
                           NIL operation ;
                           PAIR } ;
                 DIP { DROP ; DROP ; DROP } }
               { IF_LEFT { RENAME @_identity_addr_slash_13 ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           { DIP { DUP } ; SWAP } ;
                           CAR @identity ;
                           SENDER ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           CDR %admin ;
                           COMPARE ;
                           NEQ ;
                           IF { SENDER ;
                                PUSH string "Not allowed operation for this address." ;
                                PAIR ;
                                FAILWITH }
                              { { DIP { DUP @storage } ; SWAP } ;
                                CAR %deposits ;
                                { DIP { DUP @identity } ; SWAP } ;
                                GET ;
                                IF_NONE { DUP @identity ;
                                          PUSH string "Identity not found" ;
                                          PAIR ;
                                          FAILWITH }
                                        { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                          CDR %admin ;
                                          { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                                          CAR %deposits ;
                                          { DIP { { DIP { { DIP { DUP @identity } ; SWAP } } ; SWAP } } ; SWAP } ;
                                          DIP { NONE mutez } ;
                                          UPDATE ;
                                          PAIR %deposits %admin ;
                                          NIL operation ;
                                          { DIP { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                          CDR @addr ;
                                          { DIP { { DIP { { DIP { DUP @deposit } ; SWAP } } ; SWAP } } ; SWAP } ;
                                          DIP { DIP { DIP { DIP { DROP } } } } ;
                                          PAIR ;
                                          DUP ;
                                          CDR @dest ;
                                          IMPLICIT_ACCOUNT ;
                                          SWAP ;
                                          CAR @amount ;
                                          UNIT ;
                                          TRANSFER_TOKENS ;
                                          CONS ;
                                          PAIR } } ;
                           DIP { DROP ; DROP ; DROP } }
                         { RENAME @new_admin_slash_18 ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           DUP @storage ;
                           CDR %admin ;
                           SENDER ;
                           COMPARE ;
                           EQ ;
                           IF { DUP @storage ;
                                CAR %deposits ;
                                { DIP { { DIP { DUP @new_admin } ; SWAP } } ; SWAP } ;
                                SWAP ;
                                PAIR %deposits %admin ;
                                NIL operation ;
                                PAIR }
                              { PUSH string "Access to 'change_admin' function is denied!!!" ;
                                FAILWITH } ;
                           DIP { DROP ; DROP } } } ;
       DIP { DROP ; DROP } }