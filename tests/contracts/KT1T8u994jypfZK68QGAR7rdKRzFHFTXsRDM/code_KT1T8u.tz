parameter (or :_entries (address %_Liq_entry_buy_for) (or (pair :sell_request %_Liq_entry_sell_for (address %buyer) (option %tokens mutez)) (or (mutez %_Liq_entry_set_target_supply) (or (pair :sell_request %_Liq_entry_finalize_sale (address %buyer) (option %tokens mutez)) (address %_Liq_entry_set_sell_adapter)))));
storage (pair :storage (map %accounts address (pair :account (mutez %balance) (mutez %to_sell))) (pair (mutez %held_supply) (pair (mutez %target_supply) (pair (option %sell_adapter address) (pair (mutez %min_tx) (pair (key_hash %destination) (pair (address %admin) (pair (string %name) (string %symbol)))))))));
code { DUP ;
       DIP { CDR @storage_slash_1 } ;
       CAR @parameter_slash_2 ;
       DUP @parameter ;
       IF_LEFT { RENAME @buyer_slash_50 ;
                 { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                 { DIP { DUP @buyer } ; SWAP } ;
                 PAIR ;
                 DUP ;
                 CDR @storage ;
                 DUP @storage ;
                 { CDR ; CDR ; CDR ; CDR ; CAR %min_tx } ;
                 AMOUNT @amount ;
                 COMPARE ;
                 GE ;
                 DUP @b ;
                 NOT ;
                 IF { UNIT ;
                      FAILWITH }
                    { UNIT } ;
                 DIP { DROP } ;
                 DROP ;
                 DUP @storage ;
                 { CDR ; CDR ; CAR @target %target_supply } ;
                 { DIP { DUP @storage } ; SWAP } ;
                 { CDR ; CAR @held %held_supply } ;
                 DUP @held ;
                 { DIP { DIP { DUP @target } ; SWAP } ; SWAP } ;
                 COMPARE ;
                 GT ;
                 DUP @b ;
                 NOT ;
                 IF { UNIT ;
                      FAILWITH }
                    { UNIT } ;
                 DIP { DROP } ;
                 DROP ;
                 DUP @held ;
                 { DIP { DIP { DUP @target } ; SWAP } ; SWAP } ;
                 SUB @available ;
                 AMOUNT @amount ;
                 COMPARE ;
                 LE ;
                 DUP @b ;
                 NOT ;
                 IF { UNIT ;
                      FAILWITH }
                    { UNIT } ;
                 DIP { DROP } ;
                 DROP ;
                 { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                 AMOUNT @amount ;
                 PAIR ;
                 { DIP { DIP { DIP { DIP { DUP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 CAR @buyer ;
                 PAIR ;
                 DUP ;
                 CAR @buyer ;
                 { DIP { DUP } ; SWAP } ;
                 { CDR ; CAR @tokens } ;
                 { DIP { DIP { DUP } ; SWAP } ; SWAP } ;
                 { CDR ; CDR @storage } ;
                 DUP @storage ;
                 CAR %accounts ;
                 { DIP { DIP { DIP { DUP @buyer } ; SWAP } ; SWAP } ; SWAP } ;
                 PAIR ;
                 DUP ;
                 CDR @accounts ;
                 { DIP { DUP } ; SWAP } ;
                 CAR @buyer ;
                 GET ;
                 IF_NONE { PUSH mutez 0 ; PUSH mutez 0 ; PAIR %balance %to_sell } {} ;
                 DIP { DROP } ;
                 { DIP { DUP @storage } ; SWAP } ;
                 DUP ;
                 CAR %accounts ;
                 SWAP ;
                 CDR ;
                 CDR ;
                 { DIP { DIP { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 { DIP { DIP { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 { CDR ; CAR %held_supply } ;
                 ADD ;
                 PAIR %held_supply ;
                 SWAP ;
                 PAIR @storage %accounts ;
                 DUP @storage ;
                 CDR ;
                 { DIP { DUP @storage } ; SWAP } ;
                 CAR %accounts ;
                 { DIP { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ; SWAP } ;
                 CDR %to_sell ;
                 { DIP { DIP { DIP { DIP { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 { DIP { DIP { DIP { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 CAR %balance ;
                 ADD ;
                 PAIR @account %balance %to_sell ;
                 { DIP { DIP { DIP { DIP { DIP { DIP { DIP { DUP @buyer } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                 DIP { SOME } ;
                 { DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP } } } } } ;
                 UPDATE ;
                 PAIR %accounts ;
                 DUP ;
                 NIL operation ;
                 { DIP { DIP { DUP } ; SWAP } ; SWAP } ;
                 { DIP { DIP { DIP { DROP } } } } ;
                 { CDR ; CDR ; CDR ; CDR ; CDR ; CAR %destination } ;
                 IMPLICIT_ACCOUNT ;
                 AMOUNT @amount ;
                 UNIT ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 PAIR }
               { IF_LEFT { RENAME @request_slash_52 ;
                           { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                           DUP @storage ;
                           { CDR ; CDR ; CDR ; CDR ; CDR ; CDR ; CAR %admin } ;
                           SENDER ;
                           COMPARE ;
                           EQ ;
                           { DIP { DUP @storage } ; SWAP } ;
                           DUP @storage ;
                           { CDR ; CDR ; CDR ; CAR %sell_adapter } ;
                           IF_NONE { UNIT ; FAILWITH } {} ;
                           DIP { DROP } ;
                           SENDER ;
                           COMPARE ;
                           EQ ;
                           OR ;
                           { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ;
                           CAR %buyer ;
                           SENDER ;
                           COMPARE ;
                           EQ ;
                           OR ;
                           DUP @b ;
                           NOT ;
                           IF { UNIT ;
                                FAILWITH }
                              { UNIT } ;
                           DIP { DROP } ;
                           DROP ;
                           DUP @storage ;
                           { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ;
                           PAIR ;
                           DUP ;
                           CAR @request ;
                           { DIP { DUP } ; SWAP } ;
                           CDR @storage ;
                           PUSH mutez 0 ;
                           AMOUNT ;
                           COMPARE ;
                           EQ ;
                           DUP @b ;
                           NOT ;
                           IF { UNIT ;
                                FAILWITH }
                              { UNIT } ;
                           DIP { DROP } ;
                           DROP ;
                           DUP @storage ;
                           CAR %accounts ;
                           { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ;
                           CAR %buyer ;
                           PAIR ;
                           DUP ;
                           CDR @accounts ;
                           { DIP { DUP } ; SWAP } ;
                           CAR @buyer ;
                           GET ;
                           IF_NONE { PUSH mutez 0 ; PUSH mutez 0 ; PAIR %balance %to_sell } {} ;
                           DIP { DROP } ;
                           DUP @account ;
                           CDR %to_sell ;
                           { DIP { DUP @account } ; SWAP } ;
                           CAR %balance ;
                           SUB @remaining ;
                           { DIP { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ; SWAP } ;
                           CDR %tokens ;
                           IF_NONE { DUP @remaining } {} ;
                           RENAME @tokens ;
                           { DIP { DUP @remaining } ; SWAP } ;
                           { DIP { DUP @tokens } ; SWAP } ;
                           COMPARE ;
                           LE ;
                           DUP @b ;
                           NOT ;
                           IF { UNIT ;
                                FAILWITH }
                              { UNIT } ;
                           DIP { DROP } ;
                           DROP ;
                           { DIP { DUP @remaining } ; SWAP } ;
                           { DIP { DUP @tokens } ; SWAP } ;
                           COMPARE ;
                           EQ ;
                           PUSH mutez 0 ;
                           { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ;
                           COMPARE ;
                           GT ;
                           AND ;
                           { DIP { DIP { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                           { CDR ; CDR ; CDR ; CDR ; CAR %min_tx } ;
                           { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ;
                           COMPARE ;
                           GE ;
                           OR ;
                           DUP @b ;
                           NOT ;
                           IF { UNIT ;
                                FAILWITH }
                              { UNIT } ;
                           DIP { DROP } ;
                           DROP ;
                           { DIP { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ; SWAP } ;
                           { DIP { DUP @tokens } ; SWAP } ;
                           PAIR ;
                           { DIP { DIP { DIP { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                           CAR %buyer ;
                           PAIR ;
                           DUP ;
                           CAR @buyer ;
                           { DIP { DUP } ; SWAP } ;
                           { CDR ; CDR @storage } ;
                           DUP @storage ;
                           CAR %accounts ;
                           { DIP { DIP { DUP @buyer } ; SWAP } ; SWAP } ;
                           PAIR ;
                           DUP ;
                           CDR @accounts ;
                           { DIP { DUP } ; SWAP } ;
                           CAR @buyer ;
                           GET ;
                           IF_NONE { PUSH mutez 0 ; PUSH mutez 0 ; PAIR %balance %to_sell } {} ;
                           DIP { DROP } ;
                           { DIP { DUP @storage } ; SWAP } ;
                           CDR ;
                           { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                           CAR %accounts ;
                           { DIP { DIP { DIP { DIP { DIP { DUP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                           { CDR ; CAR @tokens } ;
                           { DIP { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ; SWAP } ;
                           CDR %to_sell ;
                           ADD ;
                           { DIP { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ; SWAP } ;
                           CAR %balance ;
                           PAIR @account %balance %to_sell ;
                           { DIP { DIP { DIP { DIP { DIP { DUP @buyer } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                           DIP { SOME } ;
                           { DIP { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP ; DROP } } } } } ;
                           UPDATE ;
                           PAIR %accounts ;
                           NIL @noop operation ;
                           PAIR }
                         { IF_LEFT { RENAME @new_target_supply_slash_54 ;
                                     { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                                     DUP @storage ;
                                     DUP @storage ;
                                     { CDR ; CDR ; CDR ; CDR ; CDR ; CDR ; CAR %admin } ;
                                     SENDER ;
                                     COMPARE ;
                                     EQ ;
                                     DUP @b ;
                                     NOT ;
                                     IF { UNIT ;
                                          FAILWITH }
                                        { UNIT } ;
                                     DIP { DROP ; DROP } ;
                                     DROP ;
                                     PUSH mutez 0 ;
                                     AMOUNT ;
                                     COMPARE ;
                                     EQ ;
                                     DUP @b ;
                                     NOT ;
                                     IF { UNIT ;
                                          FAILWITH }
                                        { UNIT } ;
                                     DIP { DROP } ;
                                     DROP ;
                                     DUP ;
                                     CAR %accounts ;
                                     SWAP ;
                                     CDR ;
                                     DUP ;
                                     CAR %held_supply ;
                                     SWAP ;
                                     CDR ;
                                     CDR ;
                                     { DIP { DIP { DIP { DUP } ; SWAP } ; SWAP } ; SWAP } ;
                                     { DIP { DIP { DIP { DIP { DROP } } } } } ;
                                     PAIR %target_supply ;
                                     SWAP ;
                                     PAIR %held_supply ;
                                     SWAP ;
                                     PAIR @storage %accounts ;
                                     NIL @noop operation ;
                                     PAIR }
                                   { IF_LEFT { RENAME @request_slash_57 ;
                                               { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                                               DUP @storage ;
                                               DUP @storage ;
                                               { CDR ; CDR ; CDR ; CDR ; CDR ; CDR ; CAR %admin } ;
                                               SENDER ;
                                               COMPARE ;
                                               EQ ;
                                               DUP @b ;
                                               NOT ;
                                               IF { UNIT ;
                                                    FAILWITH }
                                                  { UNIT } ;
                                               DIP { DROP ; DROP } ;
                                               DROP ;
                                               PUSH mutez 0 ;
                                               AMOUNT ;
                                               COMPARE ;
                                               EQ ;
                                               DUP @b ;
                                               NOT ;
                                               IF { UNIT ;
                                                    FAILWITH }
                                                  { UNIT } ;
                                               DIP { DROP } ;
                                               DROP ;
                                               DUP @storage ;
                                               CAR %accounts ;
                                               { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ;
                                               CAR %buyer ;
                                               PAIR ;
                                               DUP ;
                                               CDR @accounts ;
                                               { DIP { DUP } ; SWAP } ;
                                               CAR @buyer ;
                                               GET ;
                                               IF_NONE { PUSH mutez 0 ; PUSH mutez 0 ; PAIR %balance %to_sell } {} ;
                                               DIP { DROP } ;
                                               { DIP { DIP { DUP @request } ; SWAP } ; SWAP } ;
                                               CDR %tokens ;
                                               IF_NONE { DUP @account ; CDR %to_sell } {} ;
                                               RENAME @tokens ;
                                               DUP @tokens ;
                                               { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ;
                                               CAR %balance ;
                                               SUB @balance ;
                                               { DIP { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ; SWAP } ;
                                               DUP ;
                                               CAR %accounts ;
                                               SWAP ;
                                               CDR ;
                                               CDR ;
                                               { DIP { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ; SWAP } ;
                                               { DIP { DIP { DIP { DIP { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                               { CDR ; CAR %held_supply } ;
                                               SUB ;
                                               PAIR %held_supply ;
                                               SWAP ;
                                               PAIR @storage %accounts ;
                                               DUP @storage ;
                                               CDR ;
                                               { DIP { DUP @storage } ; SWAP } ;
                                               CAR %accounts ;
                                               PUSH mutez 0 ;
                                               { DIP { DIP { DIP { DIP { DUP @balance } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                               COMPARE ;
                                               EQ ;
                                               IF { NONE (pair :account (mutez %balance) (mutez %to_sell)) }
                                                  { { DIP { DIP { DIP { DIP { DUP @tokens } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                                    { DIP { DIP { DIP { DIP { DIP { DIP { DUP @account } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                                    CDR %to_sell ;
                                                    SUB @to_sell ;
                                                    { DIP { DIP { DIP { DIP { DUP @balance } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                                    PAIR %balance %to_sell ;
                                                    SOME } ;
                                               { DIP { DIP { DIP { DROP ; DROP ; DROP ; DROP ; DROP } } } } ;
                                               RENAME @account ;
                                               { DIP { DIP { DIP { DUP } ; SWAP } ; SWAP } ; SWAP } ;
                                               { DIP { DIP { DIP { DIP { DROP } } } } } ;
                                               CAR %buyer ;
                                               UPDATE ;
                                               PAIR @storage %accounts ;
                                               NIL @noop operation ;
                                               PAIR }
                                             { RENAME @sell_adapter_slash_67 ;
                                               { DIP { DIP { DUP @storage } ; SWAP } ; SWAP } ;
                                               DUP @storage ;
                                               DUP @storage ;
                                               { CDR ; CDR ; CDR ; CDR ; CDR ; CDR ; CAR %admin } ;
                                               SENDER ;
                                               COMPARE ;
                                               EQ ;
                                               DUP @b ;
                                               NOT ;
                                               IF { UNIT ;
                                                    FAILWITH }
                                                  { UNIT } ;
                                               DIP { DROP ; DROP } ;
                                               DROP ;
                                               PUSH mutez 0 ;
                                               AMOUNT ;
                                               COMPARE ;
                                               EQ ;
                                               DUP @b ;
                                               NOT ;
                                               IF { UNIT ;
                                                    FAILWITH }
                                                  { UNIT } ;
                                               DIP { DROP } ;
                                               DROP ;
                                               DUP ;
                                               CAR %accounts ;
                                               SWAP ;
                                               CDR ;
                                               DUP ;
                                               CAR %held_supply ;
                                               SWAP ;
                                               CDR ;
                                               DUP ;
                                               CAR %target_supply ;
                                               SWAP ;
                                               CDR ;
                                               CDR ;
                                               { DIP { DIP { DIP { DIP { DUP } ; SWAP } ; SWAP } ; SWAP } ; SWAP } ;
                                               { DIP { DIP { DIP { DIP { DIP { DROP } } } } } } ;
                                               SOME ;
                                               PAIR %sell_adapter ;
                                               SWAP ;
                                               PAIR %target_supply ;
                                               SWAP ;
                                               PAIR %held_supply ;
                                               SWAP ;
                                               PAIR @storage %accounts ;
                                               NIL @noop operation ;
                                               PAIR } } } } ;
       DIP { DROP ; DROP } }